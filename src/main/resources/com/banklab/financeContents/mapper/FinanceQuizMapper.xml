<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.banklab.financeContents.mapper.FinanceQuizMapper">

    <!-- 결과 매핑 -->
    <resultMap id="FinanceQuizResultMap" type="com.banklab.financeContents.domain.FinanceQuizVO">
        <id property="id" column="id"/>
        <result property="quizType" column="quiz_type"/>
        <result property="question" column="question"/>
        <result property="option1" column="option1"/>
        <result property="option2" column="option2"/>
        <result property="option3" column="option3"/>
        <result property="option4" column="option4"/>
        <result property="answer" column="answer"/>
        <result property="explanation" column="explanation"/>
    </resultMap>

    <!-- 모든 퀴즈 조회 -->
    <select id="findAllQuizzes" resultMap="FinanceQuizResultMap">
        SELECT id, quiz_type, question, option1, option2, option3, option4, answer, explanation
        FROM finance_quiz
        ORDER BY id
    </select>

    <!-- 퀴즈 타입별 조회 -->
    <select id="findQuizzesByType" parameterType="String" resultMap="FinanceQuizResultMap">
        SELECT id, quiz_type, question, option1, option2, option3, option4, answer, explanation
        FROM finance_quiz
        WHERE quiz_type = #{quizType}
        ORDER BY id
    </select>

    <!-- ID로 퀴즈 조회 -->
    <select id="findQuizById" parameterType="Integer" resultMap="FinanceQuizResultMap">
        SELECT id, quiz_type, question, option1, option2, option3, option4, answer, explanation
        FROM finance_quiz
        WHERE id = #{id}
    </select>

    <!-- 랜덤 퀴즈 조회 -->
    <select id="findRandomQuizzes" parameterType="int" resultMap="FinanceQuizResultMap">
        SELECT id, quiz_type, question, option1, option2, option3, option4, answer, explanation
        FROM finance_quiz
        ORDER BY RAND()
        LIMIT #{limit}
    </select>

    <!-- 타입별 랜덤 퀴즈 조회 -->
    <select id="findRandomQuizzesByType" parameterType="map" resultMap="FinanceQuizResultMap">
        SELECT id, quiz_type, question, option1, option2, option3, option4, answer, explanation
        FROM finance_quiz
        WHERE quiz_type = #{quizType}
        ORDER BY RAND()
        LIMIT #{limit}
    </select>

    <!-- 퀴즈 추가 -->
    <insert id="insertQuiz" parameterType="com.banklab.financeContents.domain.FinanceQuizVO">
        INSERT INTO finance_quiz (quiz_type, question, option1, option2, option3, option4, answer, explanation)
        VALUES (#{quizType}, #{question}, #{option1}, #{option2}, #{option3}, #{option4}, #{answer}, #{explanation})
    </insert>

    <!-- 퀴즈 수정 -->
    <update id="updateQuiz" parameterType="com.banklab.financeContents.domain.FinanceQuizVO">
        UPDATE finance_quiz
        SET quiz_type = #{quizType},
            question = #{question},
            option1 = #{option1},
            option2 = #{option2},
            option3 = #{option3},
            option4 = #{option4},
            answer = #{answer},
            explanation = #{explanation}
        WHERE id = #{id}
    </update>

    <!-- 퀴즈 삭제 -->
    <delete id="deleteQuiz" parameterType="Integer">
        DELETE FROM finance_quiz WHERE id = #{id}
    </delete>

    <!-- 전체 퀴즈 개수 조회 -->
    <select id="getTotalQuizCount" resultType="int">
        SELECT COUNT(*) FROM finance_quiz
    </select>

    <!-- 타입별 퀴즈 개수 조회 -->
    <select id="getQuizCountByType" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM finance_quiz WHERE quiz_type = #{quizType}
    </select>

    <!-- 인덱스 범위로 퀴즈 조회 (오늘의 퀴즈용) -->
    <select id="findQuizzesByIndexRange" parameterType="map" resultMap="FinanceQuizResultMap">
        SELECT id, quiz_type, question, option1, option2, option3, option4, answer, explanation
        FROM finance_quiz
        WHERE id BETWEEN #{startIndex} AND #{endIndex}
        ORDER BY id
        LIMIT 3
    </select>

</mapper>
